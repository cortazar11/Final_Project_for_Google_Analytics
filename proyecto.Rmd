---
title: "PROYECTO"
output: html_document
date: '2022-12-13'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



```{r}
library(tidyverse)
library(readr)
```

Este trabajo está realizado para el proyecto final de la certificación profesional de Google Analytics en la plataforma Coursera, pudiendo elegirse dos casos prácticos. De los dos proyectos a elegir he optado por el caso práctico 1: ¿Cómo lograr el éxito rápido de un negocio de bicicletas compartidas?

He seguido los pasos recomendados en el curso y que son: preguntar, preparar, procesar, analizar, compartir, actuar.

# PREGUNTAR

En este paso se define el problema que pretende resolverse para entender plenamente las expectativas de los interesados. La empresa ficticia Ciclystic tiene dos tipos de clientes: ciclistas ocasionales que pagan la bici solo en las ocasiones que las toman y ciclistas que han hecho una suscripcion anual pudiendolas tomar tanta veces como quieran durante la suscripcion. La directora de marketing cree que el éxito futuro de la empresa depende de maximizar el ńumero de suscripciones anuales.

Por tanto el problema que se plantea es entender qué diferencias existen en el uso de bicicletas Cyclistic entre los ciclistas ocasionales y los que tienen una suscripción anual. A través de este conocimiento, se diseñará una nueva estrategia de marketing para convertir los ciclistas ocasionales en suscriptores anuales.

En este paso tenemos que tener presente quienes son los interesados: los ejecutivos de Cyclistic, que deben aprobar las recomendaciones a partir del conocimiento que obtengamos. Pero tambien la directora de marketing, que es de dónde parte la solicitud de análisis.

Así pues estableceré estrategias de comunicación con estos interesados: la directora de marketing y los ejecutivos, y que ayudarán a enfocar el problema.

En resumen, las tres preguntas en concreto que guiarán el programa de marketing son:

1. ¿En qué se diferencian los socios anuales y los ciclistas ocasionales con respecto al uso de las bicicletas de Cyclistic?

2. ¿Por qué los ciclistas ocasionales comprarían membresías anuales de Cyclistic?

3. ¿Cómo puede usar Cyclistic los medios digitales para influenciar a los ciclistas ocasionales a convertirse en miembros?

De estas tres preguntas, la directora de marketing me asigna, como analista de datos, la primera pregunta:
¿En qué se diferencian los socios anuales y los ciclistas ocasionales con respecto al uso de las bicicletas de Cyclistic?

# PREPARAR

Para realizar el análisis los datos históricos de los viajes de Cyclistic.

La fuente de datos es un enlace a la nube de amazon aws en donde se sencuentran múltiples ficheros en formato csv de la empresa ficticia Cyclistic. Por tanto se trata de una fuente secundaria.

Hay tres tipos de ficheros con dos diferente clases de datos:

En el primero estan los datos correspondientes a los trayectos que se realizan en las bicicletas.
En el segundo, los datos correspondientes a las estaciones donde estan colocadas las bicicletas.

Para este ejercicio y tal y como se indica en las instrucciones se utilizaran los datos de los 12 últimos meses, por lo que tendremos ficheros correspondientes a los meses que van desde Diciembre 2021 a Noviembre 2022





# PROCESAR

## Limpieza ficheros de viajes 

En primer lugar hacemos una lista de las rutas a los 12 ficheros que vamos a utilizar

```{r}
  list_files <- list.files("/home/miguel/CURSO_DATA_ANALYSIS/Caso_Práctico/DATA_12MONTHS", full.names= TRUE)
  list_files
```

Despues leemos con el comando read_csv todos los ficheros indicados en las rutas anteriores para crear un marco de datos de cada fichero y añadimos una columna mas en cada marco: la de mes, que se derivará del nombre de cada fichero donde esta escrito el mes a que corresponde el fichero (202112-divvy-tripdata.csv, etc)

```{r}
    result <- lapply(list_files,
                 function(x){
                   df <- read_csv(x)
                   df$month <- x
                   df$month <- stri_replace_all_regex(df$month,
                                                      pattern=c('/home/miguel/CURSO_DATA_ANALYSIS/Caso_Práctico/DATA_12MONTHS/',   
                                                                '-divvy-tripdata.csv','-divvy-publictripdata.csv'),
                                                      replacement=c('', '', '' ),
                                                      vectorize=FALSE)
                   df$diff <- df$ended_at - df$started_at
                   df$diff_format <- ms(df$diff)
                   df
                 }
)
```
El anterior proceso nos da una lista de marcos de datos correspondientes cada uno a los 12 meses que analizaremos.

```{r}
class(result)
```
Lo que tenemos que hacer ahora con esta lista de marcos de datos es convergerlos todos en un único marco de datos donde el mes, en vez de ser el nombre del fichero será uno de los campos de ese marco, para lo cual utilizaremos el comando *do.call* con el cual en vez de aplicar una funcion a los elementos de una lista, lo que hacemos es incorporar una lista como argumentos de una funcion; en este caso *rbind*.

```{r}
    df <- do.call(rbind,result)
```

Una primera lectura al marco de datos resultante nos da los siguientes resultados.

```{r}
    colnames(df)
    head(df)
```

Con lo que pasamos al siguiente apartado que será análisis y gráficos.

# ANALIZAR

1. Hacemos un gráfico para tener una visión general de cuantos eran ciclistas ocasionales y cuantos tenían una suscripción anual.
Para ello primeramente tenemos que agrupar por meses los datos. Para ello primero convertimos el campo *member_casual* de character en factor y seguidamente agrupamos los datos por meses.

```{r}
    df$member_casual <- as.factor(df$member_casual)
    by_month <- df %>%
              group_by(month) %>%
              count(member_casual)
    by_month
```

Seguidamente hacemos un gráfico de barras que nos en las barras el ńumero de cilistas ocasionales y suscriptores, agrupados por mes.

```{r}
    p <- ggplot(by_month, aes(fill=member_casual,y=n,x=month )) +
          geom_bar(stat="identity")
    p
```
De aqui podemos sacar ya algunas conclusiones:
1. Entre Mayo y Septiembre vemos como aumenta el número de personas que utilizan la bici, coincidiendo con la mejora del tiempo.
Por otro lado vemos como el aumento es tanto de ciclistas ocasionales como de suscriptores en los meses de verano, a diferencia del resto del año donde los suscriptores son inmensa mayoria de los que utilizan la bici.

# COMPARTIR

# ACTUAR

```
#setwd("/home/miguel/CURSO_DATA_ANALYSIS/Caso_Práctico/DATA/YEARS")
list_files <-list.files(path='/home/miguel/CURSO_DATA_ANALYSIS/Caso_Práctico/DATA/YEARS') 
df <- read_csv(list_files)
str(df)
unique(df$rideable_type )
unique(df$member_casual)
  
```
